<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UGC Studio â€” AI Lifestyle Shot Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500&display=swap" rel="stylesheet">
  <style>
    /* â”€â”€â”€ ELITE BRANDS TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      /* Colour palette */
      --cyan:          #2AAEE0;
      --cyan-hover:    #2393BE;
      --cyan-active:   #1D799C;
      --cyan-dim:      rgba(42,174,224,0.10);
      --cyan-border:   rgba(42,174,224,0.25);
      --ink:           #050816;
      --surface:       #0B1B26;
      --card:          #0D2133;
      --border:        rgba(148,163,184,0.15);
      --border-form:   #4B5563;
      --slate:         #507284;
      --text:          #EFF6FF;
      --muted:         #9CA3AF;
      --success:       #22c55e;
      --error:         #FF6B6B;
      --warning:       #f59e0b;
      /* Aliases used in components */
      --accent:        var(--cyan);
      --accent-light:  #57C8F4;
      --accent-dim:    var(--cyan-dim);
      --bg:            var(--ink);
      /* Radii */
      --radius-pill:   999px;
      --radius-card:   18px;
      --radius:        18px;
      --radius-sm:     10px;
    }

    /* â”€â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--ink);
      background-image: linear-gradient(160deg, #050816 0%, #0B1B26 100%);
      background-attachment: fixed;
      color: var(--text);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }
    a { color: var(--cyan); text-underline-offset: 3px; }
    h1,h2,h3,h4 { font-family: 'Space Grotesk', sans-serif; letter-spacing: -0.02em; }

    /* â”€â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .container { max-width: 860px; margin: 0 auto; padding: 0 24px; }

    /* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      padding: 18px 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 40px;
      position: sticky;
      top: 0;
      background: rgba(5,8,22,0.88);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      z-index: 100;
    }
    .header-inner { display: flex; align-items: center; justify-content: space-between; }
    .logo { display: flex; align-items: center; gap: 12px; }
    .logo-mark {
      width: 34px; height: 34px;
      background: linear-gradient(135deg, var(--cyan) 0%, #1D799C 100%);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px;
      box-shadow: 0 0 16px rgba(42,174,224,0.25);
    }
    .logo-name { font-family: 'Space Grotesk', sans-serif; font-size: 17px; font-weight: 700; color: var(--text); }
    .logo-tag {
      font-size: 10px; background: var(--surface); border: 1px solid var(--border);
      padding: 2px 8px; border-radius: var(--radius-pill); color: var(--muted);
      text-transform: uppercase; letter-spacing: 0.08em; font-family: 'Inter', sans-serif;
    }
    .icon-btn {
      background: none; border: 1px solid var(--border); border-radius: var(--radius-sm);
      padding: 8px; color: var(--muted); cursor: pointer; display: flex;
      align-items: center; transition: all .2s;
    }
    .icon-btn:hover { color: var(--cyan); border-color: var(--cyan); }

    /* â”€â”€â”€ STATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .state { display: none; }
    .state.active { display: block; }

    /* â”€â”€â”€ CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-card);
      padding: 28px 32px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.3);
    }

    /* â”€â”€â”€ FORM ELEMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .field { margin-bottom: 20px; }
    .field:last-child { margin-bottom: 0; }
    .field label {
      display: block; font-size: 11px; font-weight: 600; color: var(--muted);
      text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 7px;
    }
    input[type="text"], input[type="url"], textarea, select {
      width: 100%; background: var(--surface); border: 1px solid var(--border-form);
      border-radius: var(--radius-sm); padding: 11px 14px;
      color: var(--text); font-family: 'Inter', sans-serif; font-size: 14px;
      outline: none; transition: border-color .2s, box-shadow .2s;
      appearance: none;
    }
    input::placeholder, textarea::placeholder { color: var(--muted); }
    input:focus, textarea:focus, select:focus {
      border-color: var(--cyan);
      box-shadow: 0 0 0 2px rgba(42,174,224,0.18);
    }
    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239CA3AF' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 12px center; padding-right: 36px; cursor: pointer;
    }

    /* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn {
      display: inline-flex; align-items: center; justify-content: center; gap: 7px;
      padding: 11px 24px; border-radius: var(--radius-pill);
      font-family: 'Space Grotesk', sans-serif; font-size: 14px; font-weight: 600;
      cursor: pointer; border: none; transition: all .2s; text-decoration: none;
      letter-spacing: 0.01em;
    }
    .btn-primary { background: var(--cyan); color: var(--ink); }
    .btn-primary:hover {
      background: var(--cyan-hover);
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(42,174,224,0.35);
    }
    .btn-primary:active { background: var(--cyan-active); transform: none; box-shadow: none; }
    .btn-secondary {
      background: transparent; color: var(--cyan);
      border: 1px solid var(--cyan);
    }
    .btn-secondary:hover { background: var(--cyan-dim); }
    .btn-ghost { background: none; color: var(--muted); border: none; padding: 8px 16px; }
    .btn-ghost:hover { color: var(--text); }
    .btn-sm { padding: 7px 16px; font-size: 12px; }
    .btn-full { width: 100%; }
    .btn:disabled { opacity: .45; pointer-events: none; }
    .btn:focus-visible { outline: 2px solid rgba(42,174,224,0.7); outline-offset: 2px; }

    /* â”€â”€â”€ SHOT TYPE GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .shot-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; margin-top: 8px; }
    .shot-option { position: relative; }
    .shot-option input { position: absolute; opacity: 0; width: 0; height: 0; }
    .shot-option label {
      display: flex; flex-direction: column; align-items: center; gap: 6px;
      padding: 14px 10px; background: var(--surface); border: 2px solid var(--border-form);
      border-radius: var(--radius-sm); cursor: pointer; transition: all .18s;
      text-align: center; text-transform: none; letter-spacing: 0; color: var(--text);
    }
    .shot-option input:checked + label {
      border-color: var(--cyan); background: var(--cyan-dim);
      box-shadow: 0 0 0 1px rgba(42,174,224,0.12) inset;
    }
    .shot-option label:hover { border-color: rgba(42,174,224,0.45); }
    .shot-emoji { font-size: 22px; }
    .shot-name { font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600; }
    .shot-desc { font-size: 10px; color: var(--muted); line-height: 1.4; }

    /* â”€â”€â”€ ASPECT RATIO TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ratio-toggle {
      display: flex; background: var(--surface);
      border: 1px solid var(--border-form); border-radius: var(--radius-sm);
      overflow: hidden; width: fit-content;
    }
    .ratio-btn {
      padding: 9px 22px; background: none; border: none; border-right: 1px solid var(--border-form);
      color: var(--muted); font-family: 'Space Grotesk', sans-serif;
      font-size: 13px; font-weight: 600; cursor: pointer; transition: all .15s;
      line-height: 1;
    }
    .ratio-btn:last-child { border-right: none; }
    .ratio-btn.active { background: var(--cyan); color: var(--ink); }
    .ratio-btn:hover:not(.active) { color: var(--text); background: var(--cyan-dim); }

    /* â”€â”€â”€ OPTIONS ROW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

    /* â”€â”€â”€ PRODUCT PREVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #product-preview {
      display: none; margin-top: 24px;
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius-card); overflow: hidden;
      box-shadow: 0 4px 24px rgba(0,0,0,0.3);
      /* Cyan accent line on top */
      border-top: 2px solid var(--cyan);
      animation: slideDown .25s ease;
    }
    #product-preview.show { display: block; }
    @keyframes slideDown { from { opacity:0; transform:translateY(-8px); } to { opacity:1; transform:none; } }
    .preview-header {
      padding: 20px 24px; display: flex; gap: 16px; align-items: flex-start;
      border-bottom: 1px solid var(--border);
    }
    .preview-thumb {
      width: 60px; height: 60px; border-radius: 10px; object-fit: cover;
      background: var(--surface); flex-shrink: 0;
      border: 1px solid var(--border);
    }
    .preview-meta { flex: 1; min-width: 0; }
    .preview-name { font-size: 17px; font-weight: 700; line-height: 1.3; letter-spacing: -0.02em; }
    .preview-brand { font-size: 13px; color: var(--muted); margin-top: 2px; }
    .preview-body { padding: 16px 24px; }
    .preview-desc { font-size: 13px; color: var(--muted); line-height: 1.6; margin-bottom: 14px; }
    .tags { display: flex; flex-wrap: wrap; gap: 7px; }
    .tag {
      padding: 4px 12px; background: var(--cyan-dim); border: 1px solid var(--cyan-border);
      border-radius: var(--radius-pill); font-size: 11px; color: var(--cyan); font-weight: 500;
    }
    .preview-footer {
      padding: 16px 24px; border-top: 1px solid var(--border);
      display: flex; gap: 10px; align-items: center;
    }

    /* â”€â”€â”€ PROGRESS STEPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .steps { display: flex; flex-direction: column; gap: 10px; }
    .step {
      display: flex; align-items: center; gap: 14px; padding: 14px 18px;
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius-sm); transition: all .2s;
    }
    .step.active { border-color: var(--cyan); background: var(--cyan-dim); }
    .step.done { border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.06); }
    .step.error { border-color: rgba(255,107,107,.35); background: rgba(255,107,107,.06); }
    .step-icon {
      width: 30px; height: 30px; border-radius: 50%; display: flex;
      align-items: center; justify-content: center; font-size: 13px;
      background: var(--surface); color: var(--muted); flex-shrink: 0;
    }
    .step.active .step-icon { background: var(--cyan); animation: pulse 1.4s infinite; }
    .step.done .step-icon { background: var(--success); }
    .step.error .step-icon { background: var(--error); }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.55} }
    .step-label { font-size: 14px; font-weight: 600; }
    .step-sub { font-size: 12px; color: var(--muted); margin-top: 2px; }

    /* â”€â”€â”€ RESULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .results-bar {
      display: flex; align-items: center; justify-content: space-between;
      flex-wrap: wrap; gap: 12px; margin-bottom: 24px;
    }
    .results-bar h2 { font-size: 22px; }
    .results-bar-right { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .gen-status {
      display: none; align-items: center; gap: 8px;
      font-size: 13px; color: var(--muted);
    }
    .gen-status.show { display: flex; }
    .spinner {
      width: 16px; height: 16px; border: 2px solid var(--border-form);
      border-top-color: var(--cyan); border-radius: 50%;
      animation: spin .7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .img-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px,1fr)); gap: 18px; }
    .img-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius-card); overflow: hidden;
      transition: transform .2s, box-shadow .2s;
    }
    .img-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.5), 0 0 0 1px rgba(42,174,224,0.15);
    }
    .img-card img  { width: 100%; display: block; aspect-ratio: 3/4; object-fit: cover; }
    .img-card video {
      width: 100%; display: block; object-fit: cover; background: #000;
    }
    /* â”€â”€â”€ Mode toggle (reuses ratio-toggle styles) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .mode-badge {
      display: inline-flex; align-items: center; gap: 6px;
      font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.07em;
      padding: 2px 10px; border-radius: var(--radius-pill);
      background: rgba(42,174,224,0.12); color: var(--cyan); border: 1px solid var(--cyan-border);
    }
    .img-card-foot {
      padding: 10px 14px; display: flex; align-items: center;
      justify-content: space-between; gap: 8px;
      border-top: 1px solid var(--border);
    }
    .shot-badge { font-size: 11px; color: var(--muted); }

    /* Skeleton loader */
    .skel { width: 100%; aspect-ratio: 3/4; background: var(--surface); position: relative; overflow: hidden; }
    .skel::after {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(90deg, transparent 25%, rgba(42,174,224,0.04) 50%, transparent 75%);
      background-size: 200% 100%;
      animation: shimmer 1.6s infinite;
    }
    @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    .skel-foot { padding: 10px 14px; }
    .skel-line { height: 10px; background: var(--surface); border-radius: var(--radius-pill); width: 60%; }

    /* Error card */
    .err-card {
      aspect-ratio: 3/4; display: flex; flex-direction: column;
      align-items: center; justify-content: center; gap: 10px;
      padding: 20px; background: var(--surface);
    }

    /* â”€â”€â”€ ALERTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .alert {
      display: none; border-radius: var(--radius-sm); padding: 11px 14px;
      font-size: 13px; margin-top: 14px; line-height: 1.5;
    }
    .alert.show { display: block; }
    .alert-error { background: rgba(255,107,107,.08); border: 1px solid rgba(255,107,107,.3); color: var(--error); }
    .alert-info  { background: var(--cyan-dim); border: 1px solid var(--cyan-border); color: var(--cyan); }

    /* â”€â”€â”€ SECTION HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sec-head { margin-bottom: 28px; }
    .sec-head h2 { font-size: 26px; font-weight: 700; }
    .sec-head p { color: var(--muted); font-size: 15px; margin-top: 6px; line-height: 1.6; }
    .sec-head-center { text-align: center; }
    .sec-head-center h2 { margin-bottom: 8px; }

    /* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media(max-width: 640px) {
      .shot-grid { grid-template-columns: repeat(2,1fr); }
      .row2 { grid-template-columns: 1fr; }
      .card { padding: 20px; }
    }
  </style>
</head>
<body>

<!-- â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header class="header">
  <div class="container">
    <div class="header-inner">
      <div class="logo">
        <div class="logo-mark">ğŸ“¸</div>
        <div class="logo-name">UGC Studio</div>
        <span class="logo-tag">Beta</span>
      </div>
      <button class="icon-btn" onclick="App.openSettings()" title="API Settings">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06-.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
    </div>
  </div>
</header>

<main class="container" style="padding-bottom: 60px;">

  <!-- â•â•â• STATE: SETUP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="state" id="state-setup">
    <div style="max-width: 460px; margin: 0 auto; padding: 48px 0;">
      <div class="sec-head sec-head-center">
        <div style="font-size: 52px; margin-bottom: 18px;">âœ¨</div>
        <h2>Welcome to UGC Studio</h2>
        <p>Generate authentic lifestyle &amp; UGC shots from any product URL â€” powered by Gemini AI.</p>
      </div>
      <div class="card">
        <div class="field">
          <label>Gemini API Key</label>
          <input type="text" id="api-key" placeholder="AIzaâ€¦" autocomplete="off" spellcheck="false"
            onkeydown="if(event.key==='Enter') App.saveKey()">
          <p style="margin-top: 8px; font-size: 12px; color: var(--muted);">
            Get a free key at <a href="https://aistudio.google.com/apikey" target="_blank">aistudio.google.com</a>
            â€” stored in your browser only, never sent anywhere.
          </p>
        </div>
        <div id="setup-error" class="alert alert-error"></div>
        <button class="btn btn-primary btn-full" style="margin-top: 4px;" onclick="App.saveKey()">Get Started â†’</button>
      </div>
    </div>
  </div>

  <!-- â•â•â• STATE: FORM â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="state" id="state-form">
    <div style="max-width: 700px; margin: 0 auto;">
      <div class="sec-head">
        <h2>Generate UGC Shots</h2>
        <p>Paste a product page URL â€” we'll scrape the product, understand the brand &amp; audience, then generate authentic lifestyle imagery.</p>
      </div>

      <div class="card">
        <!-- URL -->
        <div class="field">
          <label>Product Page URL</label>
          <input type="url" id="product-url" placeholder="https://example.com/products/your-product"
            onkeydown="if(event.key==='Enter') App.analyzeProduct()">
        </div>

        <!-- Output Mode -->
        <div class="field">
          <label>Output Mode</label>
          <div class="ratio-toggle" id="mode-toggle">
            <button type="button" class="ratio-btn active" data-mode="image" onclick="App.setMode(this)">ğŸ“· Image</button>
            <button type="button" class="ratio-btn" data-mode="video" onclick="App.setMode(this)">ğŸ¬ Video</button>
          </div>
        </div>

        <!-- Shot Types -->
        <div class="field">
          <label>Shot Types â€” select all you want</label>
          <div class="shot-grid">
            <div class="shot-option">
              <input type="checkbox" id="s-hold" value="hold" class="shot-cb" checked>
              <label for="s-hold">
                <span class="shot-emoji">ğŸ¤³</span>
                <span class="shot-name">Authentic Hold</span>
                <span class="shot-desc">Casual real-person hold or use</span>
              </label>
            </div>
            <div class="shot-option">
              <input type="checkbox" id="s-lifestyle" value="lifestyle" class="shot-cb" checked>
              <label for="s-lifestyle">
                <span class="shot-emoji">ğŸ </span>
                <span class="shot-name">Lifestyle Scene</span>
                <span class="shot-desc">Product in a real environment</span>
              </label>
            </div>
            <div class="shot-option">
              <input type="checkbox" id="s-unboxing" value="unboxing" class="shot-cb">
              <label for="s-unboxing">
                <span class="shot-emoji">ğŸ“¦</span>
                <span class="shot-name">Unboxing</span>
                <span class="shot-desc">First discovery or opening moment</span>
              </label>
            </div>
            <div class="shot-option">
              <input type="checkbox" id="s-social" value="social" class="shot-cb">
              <label for="s-social">
                <span class="shot-emoji">ğŸ‘«</span>
                <span class="shot-name">Social Setting</span>
                <span class="shot-desc">Product with friends or group</span>
              </label>
            </div>
            <div class="shot-option">
              <input type="checkbox" id="s-outdoor" value="outdoor" class="shot-cb">
              <label for="s-outdoor">
                <span class="shot-emoji">ğŸŒ¿</span>
                <span class="shot-name">Outdoor / Active</span>
                <span class="shot-desc">On-the-go or outdoor setting</span>
              </label>
            </div>
            <div class="shot-option">
              <input type="checkbox" id="s-detail" value="detail" class="shot-cb">
              <label for="s-detail">
                <span class="shot-emoji">âœ¨</span>
                <span class="shot-name">Detail Close-Up</span>
                <span class="shot-desc">Texture, design, or key feature</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Aspect Ratio -->
        <div class="field">
          <label>Aspect Ratio</label>
          <div class="ratio-toggle">
            <button type="button" class="ratio-btn" data-ratio="1:1" onclick="App.setRatio(this)">1 : 1</button>
            <button type="button" class="ratio-btn active" data-ratio="9:16" onclick="App.setRatio(this)">9 : 16</button>
            <button type="button" class="ratio-btn" data-ratio="16:9" onclick="App.setRatio(this)">16 : 9</button>
          </div>
        </div>

        <!-- Options row -->
        <div class="row2 field">
          <div>
            <label>Creator / Model</label>
            <select id="opt-person">
              <option value="auto">Auto â€” match target audience</option>
              <option value="woman">Woman</option>
              <option value="man">Man</option>
              <option value="diverse">Diverse / Mixed</option>
            </select>
          </div>
          <div>
            <label>Visual Aesthetic</label>
            <select id="opt-aesthetic">
              <option value="auto">Auto â€” match brand style</option>
              <option value="candid">Raw &amp; Candid</option>
              <option value="bright">Bright &amp; Airy</option>
              <option value="moody">Moody &amp; Dark</option>
              <option value="minimal">Clean &amp; Minimal</option>
            </select>
          </div>
        </div>

        <!-- Extra context -->
        <div class="field">
          <label>Additional Context <span style="color:var(--muted);font-weight:400;">(optional)</span></label>
          <input type="text" id="opt-context" placeholder="e.g. summer vibes, morning routine, gym setting, New York city backdropâ€¦">
        </div>

        <div id="form-error" class="alert alert-error"></div>

        <button class="btn btn-primary" id="analyze-btn" onclick="App.analyzeProduct()" style="margin-top: 8px;">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          Analyze Product
        </button>
      </div>

      <!-- Product Preview (shown after analysis) -->
      <div id="product-preview">
        <div class="preview-header">
          <img id="pv-img" class="preview-thumb" src="" alt="" style="display:none;" onerror="this.style.display='none'">
          <div class="preview-meta">
            <div class="preview-name" id="pv-name"></div>
            <div class="preview-brand" id="pv-brand"></div>
          </div>
        </div>
        <div class="preview-body">
          <p class="preview-desc" id="pv-desc"></p>
          <div class="tags" id="pv-tags"></div>
        </div>
        <div class="preview-footer">
          <button class="btn btn-primary" id="generate-btn" onclick="App.generateImages()" style="flex:1;">
            âœ¨ Generate UGC Shots
          </button>
          <!-- label updated dynamically by setMode() -->
          <button class="btn btn-secondary" onclick="App.resetAnalysis()">Re-analyze</button>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• STATE: PROGRESS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="state" id="state-progress">
    <div style="max-width: 520px; margin: 0 auto; padding: 48px 0;">
      <div class="sec-head sec-head-center">
        <h2>Generating Your UGC Shots</h2>
        <p>Hang tight â€” this typically takes 30â€“90 seconds per image</p>
      </div>

      <div class="steps">
        <div class="step pending" id="stp-scrape">
          <div class="step-icon">ğŸ”</div>
          <div>
            <div class="step-label">Analyzing Product Page</div>
            <div class="step-sub" id="stp-scrape-sub">Extracting brand, product info &amp; audience</div>
          </div>
        </div>
        <div class="step pending" id="stp-image">
          <div class="step-icon">ğŸ–¼ï¸</div>
          <div>
            <div class="step-label">Fetching Product Image</div>
            <div class="step-sub">Loading product image as visual reference for AI</div>
          </div>
        </div>
        <div class="step pending" id="stp-prompts">
          <div class="step-icon">âœï¸</div>
          <div>
            <div class="step-label">Crafting UGC Prompts</div>
            <div class="step-sub">Writing authentic shot descriptions for each scene</div>
          </div>
        </div>
        <div class="step pending" id="stp-gen">
          <div class="step-icon">ğŸ¨</div>
          <div>
            <div class="step-label">Generating Lifestyle Images</div>
            <div class="step-sub" id="stp-gen-sub">Starting image generationâ€¦</div>
          </div>
        </div>
      </div>

      <div id="progress-error" class="alert alert-error" style="margin-top: 18px;"></div>
      <button class="btn btn-ghost btn-full" style="margin-top: 20px;" id="cancel-btn"
        onclick="App.showState('form')">â† Cancel</button>
    </div>
  </div>

  <!-- â•â•â• STATE: RESULTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="state" id="state-results">
    <div style="padding: 32px 0;">
      <div class="results-bar">
        <div>
          <h2>Your UGC Shots</h2>
          <p style="font-size: 13px; color: var(--muted); margin-top: 4px;" id="result-count">0 images generated</p>
        </div>
        <div class="results-bar-right">
          <div class="gen-status" id="gen-status">
            <div class="spinner"></div>
            <span id="gen-status-text">Generatingâ€¦</span>
          </div>
          <button class="btn btn-secondary btn-sm" onclick="App.showState('form')">â† New Product</button>
          <button class="btn btn-primary btn-sm" id="dl-all-btn" style="display:none;" onclick="App.downloadAll()">
            â†“ Download All (ZIP)
          </button>
        </div>
      </div>
      <div class="img-grid" id="img-grid"></div>
    </div>
  </div>

</main>

<!-- â”€â”€â”€ SCRIPT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script>
const App = {

  /* â”€â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  // NOTE: If image generation fails with a model-not-found error,
  // update IMAGE_MODEL to the current Gemini image generation model.
  // Check: https://ai.google.dev/gemini-api/docs/image-generation
  TEXT_MODEL:  'gemini-2.0-flash',
  IMAGE_MODEL: 'gemini-3-pro-image-preview',
  // NOTE: Veo 3.1 Fast â€” verify model name at ai.google.dev if generation fails
  VEO_MODEL:   'veo-3.1-fast',
  API:         'https://generativelanguage.googleapis.com/v1beta/models',
  STORE_KEY:   'ugc_studio_api_key',

  SHOT_DESC: {
    hold:      'Person casually holding or using the product in a natural, candid moment at home or on the go',
    lifestyle: 'Product placed alone in a beautifully styled real-world setting â€” NO people, NO hands. Product sits on a kitchen counter, wooden shelf, coffee table, bathroom ledge, or outdoor surface. Ambient lifestyle context with soft natural light, product is the sole hero.',
    unboxing:  'The moment of opening, unwrapping, or discovering the product for the first time',
    social:    'Person enjoying or sharing the product in a social gathering with friends or family',
    outdoor:   'Person actively using the product outdoors â€” walking, hiking, gym, park or city street',
    detail:    'Extreme close-up highlighting the product\'s texture, color, logo, or key feature â€” NO people, product only'
  },

  SHOT_LABEL: {
    hold: 'ğŸ¤³ Authentic Hold', lifestyle: 'ğŸ  Lifestyle',
    unboxing: 'ğŸ“¦ Unboxing', social: 'ğŸ‘« Social',
    outdoor: 'ğŸŒ¿ Outdoor', detail: 'âœ¨ Detail'
  },

  /* â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  apiKey:        '',
  productData:   null,
  productImg:    null,   // { data: base64, mimeType }
  results:       [],
  opts:          {},
  selectedRatio: '9:16',
  selectedMode:  'image',

  /* â”€â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  init() {
    this.apiKey = localStorage.getItem(this.STORE_KEY) || '';
    this.showState(this.apiKey ? 'form' : 'setup');
  },

  showState(name) {
    document.querySelectorAll('.state').forEach(s => s.classList.remove('active'));
    document.getElementById('state-' + name).classList.add('active');
  },

  /* â”€â”€â”€ API Key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  saveKey() {
    const k = document.getElementById('api-key').value.trim();
    if (!k.startsWith('AIza') || k.length < 30) {
      this.alert('setup-error', 'Invalid key â€” should start with "AIza" and be at least 30 characters.');
      return;
    }
    this.apiKey = k;
    localStorage.setItem(this.STORE_KEY, k);
    this.hideAlert('setup-error');
    this.showState('form');
  },

  openSettings() {
    const k = prompt('Enter your Gemini API key (leave blank to cancel):');
    if (!k) return;
    if (!k.startsWith('AIza') || k.length < 30) { alert('Invalid key format.'); return; }
    this.apiKey = k;
    localStorage.setItem(this.STORE_KEY, k);
  },

  /* â”€â”€â”€ Alert helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  alert(id, msg) {
    const el = document.getElementById(id);
    if (!el) return;
    el.textContent = msg;
    el.classList.add('show');
  },
  hideAlert(id) {
    const el = document.getElementById(id);
    if (el) el.classList.remove('show');
  },

  /* â”€â”€â”€ Form â€” Analyze â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async analyzeProduct() {
    const url = document.getElementById('product-url').value.trim();
    if (!url.startsWith('http')) {
      this.alert('form-error', 'Please enter a valid URL starting with https://');
      return;
    }
    const shots = [...document.querySelectorAll('.shot-cb:checked')].map(c => c.value);
    if (!shots.length) {
      this.alert('form-error', 'Select at least one shot type.');
      return;
    }
    this.hideAlert('form-error');

    const btn = document.getElementById('analyze-btn');
    btn.disabled = true;
    btn.innerHTML = '<div class="spinner" style="width:14px;height:14px;border-width:2px;"></div> Analyzingâ€¦';

    try {
      this.productData = await this.scrapeProduct(url);
      this.showPreview(this.productData);

      // Pre-fetch product image in background (non-blocking)
      if (this.productData.primaryImageUrl) {
        this.fetchProductImage(this.productData.primaryImageUrl)
          .then(img => { this.productImg = img; })
          .catch(() => {});
      }
    } catch (err) {
      this.alert('form-error', 'Analysis failed: ' + err.message + '. Check the URL and your API key.');
    } finally {
      btn.disabled = false;
      btn.innerHTML = '<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Analyze Product';
    }
  },

  showPreview(d) {
    document.getElementById('pv-name').textContent  = d.productName  || 'Product';
    document.getElementById('pv-brand').textContent = d.brandName ? 'by ' + d.brandName : '';
    document.getElementById('pv-desc').textContent  = d.description  || '';

    if (d.primaryImageUrl) {
      const img = document.getElementById('pv-img');
      img.src = d.primaryImageUrl;
      img.style.display = 'block';
    }

    const tagsEl = document.getElementById('pv-tags');
    tagsEl.innerHTML = '';
    const tags = [
      d.productCategory, d.brandAesthetic, d.pricePoint,
      d.targetDemographic?.gender, d.targetDemographic?.ageRange,
      ...(d.keyBenefits || []).slice(0, 3)
    ].filter(Boolean);
    tags.forEach(t => {
      const span = document.createElement('span');
      span.className = 'tag'; span.textContent = t;
      tagsEl.appendChild(span);
    });

    document.getElementById('product-preview').classList.add('show');
  },

  resetAnalysis() {
    document.getElementById('product-preview').classList.remove('show');
    this.productData = null;
    this.productImg  = null;
  },

  setRatio(btn) {
    document.querySelectorAll('.ratio-btn:not([data-mode])').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    this.selectedRatio = btn.dataset.ratio;
  },

  setMode(btn) {
    document.querySelectorAll('#mode-toggle .ratio-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    this.selectedMode = btn.dataset.mode;
    const genBtn = document.getElementById('generate-btn');
    if (genBtn) genBtn.innerHTML = this.selectedMode === 'video'
      ? 'ğŸ¬ Generate UGC Videos'
      : 'âœ¨ Generate UGC Shots';
  },

  /* â”€â”€â”€ Main generation flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async generateImages() {
    if (this.selectedMode === 'video') return this.generateVideos();

    const selectedShots = [...document.querySelectorAll('.shot-cb:checked')].map(c => c.value);
    // 2x output per shot type â€” duplicate the list so each type generates two distinct images
    this.opts = {
      shots:     [...selectedShots, ...selectedShots],
      person:    document.getElementById('opt-person').value,
      aesthetic: document.getElementById('opt-aesthetic').value,
      context:   document.getElementById('opt-context').value.trim(),
      ratio:     this.selectedRatio
    };

    this.showState('progress');
    this.results = [];
    ['stp-scrape','stp-image','stp-prompts','stp-gen'].forEach(id => {
      this.setStep(id, 'pending');
    });

    try {
      // Step 1 â€” already done during Analyze
      this.setStep('stp-scrape', 'done');
      document.getElementById('stp-scrape-sub').textContent =
        'Found: ' + this.productData.productName + ' by ' + (this.productData.brandName || '?');

      // Step 2 â€” product image
      this.setStep('stp-image', 'active');
      if (!this.productImg && this.productData?.primaryImageUrl) {
        try {
          this.productImg = await this.fetchProductImage(this.productData.primaryImageUrl);
          this.setStep('stp-image', 'done');
        } catch {
          this.setStep('stp-image', 'error');
        }
      } else {
        this.setStep('stp-image', this.productImg ? 'done' : 'done'); // non-fatal either way
      }

      // Step 3 â€” prompts
      this.setStep('stp-prompts', 'active');
      const prompts = await this.buildPrompts(this.productData, this.opts);
      this.setStep('stp-prompts', 'done');

      // Step 4 â€” images (switch to results and generate in place)
      this.setStep('stp-gen', 'active');
      this.showState('results');

      const grid = document.getElementById('img-grid');
      grid.innerHTML = '';
      document.getElementById('gen-status').classList.add('show');
      document.getElementById('dl-all-btn').style.display = 'none';

      // Insert skeletons
      const cssRatio = this.opts.ratio.replace(':', '/');
      for (let i = 0; i < prompts.length; i++) {
        const card = document.createElement('div');
        card.className = 'img-card'; card.id = 'skel-' + i;
        card.innerHTML = `<div class="skel" style="aspect-ratio:${cssRatio}"></div><div class="skel-foot"><div class="skel-line"></div></div>`;
        grid.appendChild(card);
      }

      // Generate each
      for (let i = 0; i < prompts.length; i++) {
        document.getElementById('gen-status-text').textContent =
          'Generating ' + (i+1) + ' of ' + prompts.length + 'â€¦';
        const type = this.opts.shots[i] || 'lifestyle';
        try {
          const imgData = await this.callImageModel(prompts[i], this.productImg, this.opts.ratio);
          this.results.push({ imgData, shotType: type }); // push BEFORE fillCard so index is correct
          this.fillCard(i, imgData, type);
          this.updateCount();
        } catch (err) {
          this.fillCardError(i, type, err.message);
        }
      }

      document.getElementById('gen-status').classList.remove('show');
      if (this.results.length > 0) document.getElementById('dl-all-btn').style.display = '';

    } catch (err) {
      this.alert('progress-error', 'Generation failed: ' + err.message);
      document.getElementById('cancel-btn').textContent = 'â† Back to Form';
    }
  },

  /* â”€â”€â”€ Video generation flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async generateVideos() {
    const selectedShots = [...document.querySelectorAll('.shot-cb:checked')].map(c => c.value);
    if (!selectedShots.length) {
      this.alert('form-error', 'Select at least one shot type.'); return;
    }
    // 2x per shot type
    this.opts = {
      shots:     [...selectedShots, ...selectedShots],
      person:    document.getElementById('opt-person').value,
      aesthetic: document.getElementById('opt-aesthetic').value,
      context:   document.getElementById('opt-context').value.trim(),
      ratio:     this.selectedRatio
    };

    this.showState('progress');
    this.results = [];
    ['stp-scrape','stp-image','stp-prompts','stp-gen'].forEach(id => this.setStep(id, 'pending'));
    document.querySelector('#state-progress h2').textContent = 'Generating Your UGC Videos';
    document.querySelector('#state-progress p').textContent = 'Hang tight â€” each video takes ~1-2 minutes to generate';

    try {
      // Step 1 â€” product analysis (reuse cached if available)
      this.setStep('stp-scrape', 'done');
      document.getElementById('stp-scrape-sub').textContent =
        'Found: ' + this.productData.productName + ' by ' + (this.productData.brandName || '?');

      // Step 2 â€” product image
      this.setStep('stp-image', 'active');
      if (!this.productImg && this.productData?.primaryImageUrl) {
        try { this.productImg = await this.fetchProductImage(this.productData.primaryImageUrl); } catch {}
      }
      this.setStep('stp-image', 'done');

      // Step 3 â€” first-frame prompts (same image prompts drive the first frame)
      this.setStep('stp-prompts', 'active');
      const framePrompts = await this.buildPrompts(this.productData, this.opts);
      this.setStep('stp-prompts', 'done');

      // Step 4 â€” generate videos
      this.setStep('stp-gen', 'active');
      this.showState('results');
      const grid = document.getElementById('img-grid');
      grid.innerHTML = '';
      document.getElementById('gen-status').classList.add('show');
      document.getElementById('dl-all-btn').style.display = 'none';

      const cssRatio = this.opts.ratio.replace(':', '/');
      const personDesc = {
        auto: 'a person matching the target demographic', woman: 'a woman', man: 'a man', diverse: 'diverse individuals'
      }[this.opts.person] || 'a person';
      const aestheticDesc = {
        auto: this.productData.brandAesthetic || 'natural and authentic', candid: 'raw and candid',
        bright: 'bright and airy', moody: 'moody and atmospheric', minimal: 'clean and minimal'
      }[this.opts.aesthetic] || 'authentic';

      // Insert skeleton cards
      for (let i = 0; i < this.opts.shots.length; i++) {
        const card = document.createElement('div');
        card.className = 'img-card'; card.id = 'skel-' + i;
        card.innerHTML = `<div class="skel" style="aspect-ratio:${cssRatio}"></div><div class="skel-foot"><div class="skel-line"></div></div>`;
        grid.appendChild(card);
      }

      for (let i = 0; i < this.opts.shots.length; i++) {
        const type = this.opts.shots[i] || 'lifestyle';
        document.getElementById('gen-status-text').textContent =
          'Generating video ' + (i+1) + ' of ' + this.opts.shots.length + ' (' + (this.SHOT_LABEL[type] || type) + ')â€¦';
        try {
          // First frame
          const firstFrame = await this.callImageModel(framePrompts[i], this.productImg, this.opts.ratio);
          // Video motion prompt
          const videoPrompt = this.buildVideoPrompt(this.productData, type, personDesc, aestheticDesc);
          // Generate video from first frame
          const videoData = await this.callVeoModel(firstFrame, videoPrompt, type, this.opts.ratio);
          this.results.push({ videoData, shotType: type, isVideo: true });
          this.fillVideoCard(i, videoData, type);
          this.updateCount();
        } catch (err) {
          this.fillCardError(i, type, err.message);
        }
      }

      document.getElementById('gen-status').classList.remove('show');
      if (this.results.length > 0) document.getElementById('dl-all-btn').style.display = '';
      document.querySelector('#state-progress h2').textContent = 'Generating Your UGC Shots';
      document.querySelector('#state-progress p').textContent = 'Hang tight â€” this typically takes 30â€“90 seconds per image';

    } catch (err) {
      this.alert('progress-error', 'Generation failed: ' + err.message);
      document.getElementById('cancel-btn').textContent = 'â† Back to Form';
      document.querySelector('#state-progress h2').textContent = 'Generating Your UGC Shots';
      document.querySelector('#state-progress p').textContent = 'Hang tight â€” this typically takes 30â€“90 seconds per image';
    }
  },

  /* â”€â”€â”€ Veo API call (image-to-video) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async callVeoModel(firstFrame, prompt, shotType, ratio) {
    const aspectRatio = ratio === '16:9' ? '16:9' : ratio === '1:1' ? '1:1' : '9:16';
    const generateAudio = shotType === 'hold'; // hold = person speaking on camera

    const instance = { prompt };
    if (firstFrame) {
      instance.image = { bytesBase64Encoded: firstFrame.data };
    }

    const body = {
      instances: [instance],
      parameters: {
        aspectRatio,
        durationSeconds: 5,
        enhancePrompt: false,
        generateAudio
      }
    };

    // Start long-running operation
    const initRes = await fetch(
      `${this.API}/${this.VEO_MODEL}:predictLongRunning?key=${this.apiKey}`,
      { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) }
    );
    if (!initRes.ok) {
      const err = await initRes.json().catch(() => ({}));
      throw new Error(err.error?.message || `Veo API error ${initRes.status}`);
    }

    const operation = await initRes.json();
    const opName = operation.name;
    if (!opName) throw new Error('Veo did not return an operation name. Check VEO_MODEL is correct.');

    // Poll every 5s, up to 3 minutes
    for (let poll = 0; poll < 36; poll++) {
      await new Promise(r => setTimeout(r, 5000));
      const pollRes = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/${opName}?key=${this.apiKey}`
      );
      const pollData = await pollRes.json();

      if (pollData.done) {
        if (pollData.error) throw new Error(pollData.error.message || 'Veo operation failed');
        const samples = pollData.response?.generateVideoResponse?.generatedSamples;
        const encodedVideo = samples?.[0]?.video?.encodedVideo;
        const mimeType = samples?.[0]?.video?.mimeType || 'video/mp4';
        if (!encodedVideo) throw new Error('Veo returned no video data in response');
        return { data: encodedVideo, mimeType };
      }

      if (pollData.error) throw new Error(pollData.error.message || 'Veo operation failed');
    }
    throw new Error('Veo timed out after 3 minutes');
  },

  /* â”€â”€â”€ Video motion prompt per shot type â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  buildVideoPrompt(d, shotType, personDesc, aestheticDesc) {
    const product = ((d.productColor || '') + ' ' + d.productName).trim();
    const settings = {
      hold:
        `${personDesc} casually holding the ${product} and speaking directly to camera. ` +
        `They give a short, genuine 5â€“8 word review â€” authentic and conversational, like a real customer video. ` +
        `Natural slight camera shake, handheld iPhone feel. ${aestheticDesc} lighting.`,

      lifestyle:
        `The ${product} rests in a beautiful real-world setting. Subtle ambient motion only â€” ` +
        `soft light shifting, steam, gentle breeze moving fabric or leaves, bokeh background. ` +
        `Absolutely no people, no hands. Cinematic slow-motion lifestyle product video. ${aestheticDesc}.`,

      unboxing:
        `${personDesc}'s hands carefully open the ${product} packaging. ` +
        `Deliberate, satisfying reveal â€” tissue paper rustling, lid lifting, product emerging into frame. ` +
        `Genuine curiosity and delight. Natural light, slightly shaky handheld iPhone feel.`,

      social:
        `Group of friends casually using and enjoying the ${product} together. ` +
        `Candid social moments, natural laughter and interaction. ` +
        `Warm ambient light, handheld iPhone feel, ${aestheticDesc}.`,

      outdoor:
        `${personDesc} confidently using the ${product} in a natural outdoor environment. ` +
        `Energetic, purposeful movement. Sun-drenched or golden-hour light. ` +
        `Slightly shaky handheld iPhone feel, ${aestheticDesc}.`,

      detail:
        `Slow cinematic push-in or lateral pan across the ${product}, ` +
        `revealing texture, colour, material quality and design details up close. ` +
        `No people. Macro-style depth of field, ${aestheticDesc}.`
    };
    return settings[shotType] || settings.lifestyle;
  },

  /* â”€â”€â”€ Video result card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  fillVideoCard(index, videoData, shotType) {
    const skel = document.getElementById('skel-' + index);
    if (!skel) return;
    const dataUrl = `data:${videoData.mimeType};base64,${videoData.data}`;
    const resultIndex = this.results.length - 1;
    const cssRatio = (this.opts.ratio || '9:16').replace(':', '/');
    const hasAudio = shotType === 'hold';
    skel.innerHTML = `
      <video src="${dataUrl}" style="aspect-ratio:${cssRatio}"
        ${hasAudio ? 'controls' : 'autoplay loop muted'} playsinline></video>
      <div class="img-card-foot">
        <span class="shot-badge">
          <span class="mode-badge">ğŸ¬ Video</span>&nbsp;${this.SHOT_LABEL[shotType] || shotType}
        </span>
        <button class="btn btn-secondary btn-sm" onclick="App.downloadByIndex(${resultIndex})">â†“ Save</button>
      </div>`;
  },

  /* â”€â”€â”€ Step helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  setStep(id, status) {
    const el = document.getElementById(id);
    if (!el) return;
    el.className = 'step ' + status;
    const icon = el.querySelector('.step-icon');
    if (!icon) return;
    const icons = { active: 'â³', done: 'âœ…', error: 'âŒ', pending: '' };
    if (icons[status]) icon.textContent = icons[status];
  },

  /* â”€â”€â”€ Scrape Product â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async scrapeProduct(url) {
    // Primary: Gemini URL context (fetches page server-side, bypasses CORS/bot protection)
    try {
      return await this._scrapeUrlContext(url);
    } catch (e) {
      console.warn('URL context failed, trying CORS fallback:', e.message);
    }

    // Fallback: fetch HTML via CORS proxies, send text to Gemini
    const html = await this._fetchHtmlProxy(url);
    const text  = this._extractPageText(html);
    return await this._scrapeFromText(text, url);
  },

  async _scrapeUrlContext(url) {
    const body = {
      tools: [{ url_context: {} }],
      contents: [{ parts: [{ text: SCRAPE_PROMPT(url) }] }],
      generationConfig: { temperature: 0.1, maxOutputTokens: 1200 }
    };
    const data = await this._gemini(this.TEXT_MODEL, body);
    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
    return this._parseJson(text);
  },

  async _fetchHtmlProxy(url) {
    const proxies = [
      `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
      `https://corsproxy.io/?${encodeURIComponent(url)}`,
      `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`
    ];
    for (const p of proxies) {
      try {
        const res = await fetch(p);
        if (res.ok) return await res.text();
      } catch {}
    }
    throw new Error('Could not fetch product page â€” check the URL and try again.');
  },

  _extractPageText(html) {
    const doc = new DOMParser().parseFromString(html, 'text/html');
    const metas = [...doc.querySelectorAll('meta[name],meta[property]')]
      .map(m => (m.getAttribute('name') || m.getAttribute('property')) + ': ' + m.getAttribute('content'))
      .join('\n');
    const body = [...doc.querySelectorAll('h1,h2,h3,p,li,[class*="product"],[class*="title"],[class*="desc"]')]
      .map(el => el.textContent.trim()).filter(t => t.length > 5).slice(0, 120).join('\n');
    return ('Title: ' + doc.title + '\n\nMeta:\n' + metas + '\n\nContent:\n' + body).substring(0, 22000);
  },

  async _scrapeFromText(text, url) {
    const body = {
      contents: [{ parts: [{ text: SCRAPE_PROMPT_TEXT(url, text) }] }],
      generationConfig: { temperature: 0.1, maxOutputTokens: 1200 }
    };
    const data = await this._gemini(this.TEXT_MODEL, body);
    const resp = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
    return this._parseJson(resp);
  },

  _parseJson(text) {
    const m = text.match(/\{[\s\S]*\}/);
    if (!m) throw new Error('Could not extract product data â€” the page may be too complex or behind a login.');
    try { return JSON.parse(m[0]); }
    catch { throw new Error('Failed to parse product data JSON.'); }
  },

  /* â”€â”€â”€ Fetch product image â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async fetchProductImage(imgUrl) {
    if (!imgUrl || imgUrl === 'null') return null;
    const attempts = [
      () => fetch(imgUrl),
      () => fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(imgUrl)}`),
      () => fetch(`https://corsproxy.io/?${encodeURIComponent(imgUrl)}`)
    ];
    for (const attempt of attempts) {
      try {
        const res = await attempt();
        if (!res.ok) continue;
        const blob = await res.blob();
        if (!blob.type.startsWith('image/')) continue;
        return await this._blobToBase64(blob);
      } catch {}
    }
    return null;
  },

  _blobToBase64(blob) {
    return new Promise((resolve, reject) => {
      const r = new FileReader();
      r.onload = () => resolve({ data: r.result.split(',')[1], mimeType: blob.type || 'image/jpeg' });
      r.onerror = reject;
      r.readAsDataURL(blob);
    });
  },

  /* â”€â”€â”€ Build prompts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async buildPrompts(d, opts) {
    const personDesc = {
      auto:    'a person matching the target demographic (' + (d.targetDemographic?.gender || 'any gender') + ', ' + (d.targetDemographic?.ageRange || 'adult') + ')',
      woman:   'a woman',
      man:     'a man',
      diverse: 'diverse individuals (vary ethnicity/gender across shots)'
    }[opts.person] || 'a person';

    const aestheticDesc = {
      auto:    'matching the brand aesthetic: ' + (d.brandAesthetic || 'natural and authentic'),
      candid:  'raw and candid, slightly imperfect, documentary-style',
      bright:  'bright, airy, warm and welcoming, golden hour tones',
      moody:   'moody, high-contrast, atmospheric and dramatic',
      minimal: 'clean, minimal, lots of negative space, Scandinavian feel'
    }[opts.aesthetic] || 'authentic';

    const shotList = opts.shots
      .map((s, i) => `${i+1}. ${s.toUpperCase()}: ${this.SHOT_DESC[s] || s}`)
      .join('\n');

    const body = {
      contents: [{ parts: [{ text: PROMPT_BUILDER(d, personDesc, aestheticDesc, shotList, opts) }] }],
      generationConfig: { temperature: 0.85, maxOutputTokens: 2500 }
    };

    const data = await this._gemini(this.TEXT_MODEL, body);
    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
    const m = text.match(/\[[\s\S]*\]/);
    if (!m) throw new Error('Could not generate image prompts â€” try again.');
    const arr = JSON.parse(m[0]);
    if (!Array.isArray(arr)) throw new Error('Prompt output was not an array.');
    return arr;
  },

  /* â”€â”€â”€ Image generation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async callImageModel(prompt, productImg, ratio) {
    const parts = [];

    // Aspect ratio instructions in the prompt (generationConfig.aspectRatio is Imagen-only)
    const ratioDesc = {
      '1:1':  'square format (1:1 aspect ratio)',
      '9:16': 'vertical portrait format (9:16 aspect ratio, tall)',
      '16:9': 'horizontal landscape format (16:9 aspect ratio, wide)'
    }[ratio] || 'vertical portrait format (9:16 aspect ratio)';

    const ratioInstruction = `Generate the image in ${ratioDesc}.`;

    const realism = `Photorealistic iPhone photography. Shot on iPhone 15 Pro with natural available light â€” no studio lighting, no flash, no professional setup. Hyper-realistic, looks exactly like a real consumer photo. Authentic imperfections: slight lens distortion, natural shadows, real depth of field. NOT a render, NOT stock photography, NOT advertising imagery.`;

    if (productImg) {
      parts.push({ inlineData: { mimeType: productImg.mimeType, data: productImg.data } });
      parts.push({
        text: `${realism} The image above shows the product to feature â€” reproduce it accurately (same color, shape, branding). ${ratioInstruction} Scene: ${prompt}`
      });
    } else {
      parts.push({ text: `${realism} ${ratioInstruction} ${prompt}` });
    }

    const body = {
      contents: [{ parts }],
      generationConfig: { responseModalities: ['IMAGE', 'TEXT'] }
    };

    const data = await this._gemini(this.IMAGE_MODEL, body);
    console.log('[UGC Studio] Raw image API response:', JSON.stringify(data, null, 2));

    const responseParts = data.candidates?.[0]?.content?.parts || [];

    // Check for image data (API response uses camelCase inlineData)
    const imgPart = responseParts.find(p => p.inlineData?.data);
    if (imgPart) {
      return { data: imgPart.inlineData.data, mimeType: imgPart.inlineData.mimeType || 'image/jpeg' };
    }

    // No image returned â€” surface the actual reason
    const finishReason = data.candidates?.[0]?.finishReason || 'UNKNOWN';
    const textResponse = responseParts.find(p => p.text)?.text || '';
    const blockReason = data.promptFeedback?.blockReason;

    console.warn('[UGC Studio] No image found. finishReason:', finishReason, '| blockReason:', blockReason, '| text:', textResponse);

    if (blockReason) throw new Error(`Blocked by safety filter: ${blockReason}`);
    if (finishReason === 'SAFETY') throw new Error('Image blocked by safety filters.');
    if (textResponse) throw new Error(`Model returned text instead of image: "${textResponse.substring(0, 200)}"`);
    throw new Error(`No image in response (finishReason: ${finishReason}). Open DevTools â†’ Console for full response details.`);
  },

  /* â”€â”€â”€ Gemini API wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async _gemini(model, body) {
    const res = await fetch(`${this.API}/${model}:generateContent?key=${this.apiKey}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err.error?.message || `API error ${res.status}`);
    }
    return res.json();
  },

  /* â”€â”€â”€ Results cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  fillCard(index, imgData, shotType) {
    const skel = document.getElementById('skel-' + index);
    if (!skel) return;
    const dataUrl = `data:${imgData.mimeType};base64,${imgData.data}`;
    // Store result so download can look up by index (avoids embedding huge base64 in onclick attr)
    const resultIndex = this.results.length - 1;
    const cssRatio = (this.opts.ratio || '9:16').replace(':', '/');
    skel.innerHTML = `
      <img src="${dataUrl}" alt="${this.SHOT_LABEL[shotType] || shotType}" loading="lazy" style="aspect-ratio:${cssRatio}">
      <div class="img-card-foot">
        <span class="shot-badge">${this.SHOT_LABEL[shotType] || shotType}</span>
        <button class="btn btn-secondary btn-sm" onclick="App.downloadByIndex(${resultIndex})">â†“ Save</button>
      </div>`;
  },

  fillCardError(index, shotType, msg) {
    const skel = document.getElementById('skel-' + index);
    if (!skel) return;
    skel.innerHTML = `
      <div class="err-card">
        <span style="font-size:28px;">âš ï¸</span>
        <p style="font-size:12px;color:var(--muted);text-align:center;max-width:200px;">${msg}</p>
      </div>
      <div class="img-card-foot"><span class="shot-badge">${this.SHOT_LABEL[shotType] || shotType}</span></div>`;
  },

  updateCount() {
    const n = this.results.length;
    const noun = this.selectedMode === 'video' ? 'video' : 'image';
    document.getElementById('result-count').textContent = n + ' ' + noun + (n !== 1 ? 's' : '') + ' generated';
  },

  /* â”€â”€â”€ Download â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  download(dataUrl, filename) {
    const a = document.createElement('a');
    a.href = dataUrl; a.download = filename;
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
  },

  downloadByIndex(i) {
    const r = this.results[i];
    if (r?.isVideo) {
      if (!r.videoData?.data) return;
      const ext = r.videoData.mimeType?.includes('mp4') ? 'mp4' : 'webm';
      this.download(`data:${r.videoData.mimeType};base64,${r.videoData.data}`, `ugc-${r.shotType}-${i+1}.${ext}`);
    } else {
      if (!r?.imgData?.data) return;
      this.download(`data:${r.imgData.mimeType};base64,${r.imgData.data}`, `ugc-${r.shotType}-${i+1}.jpg`);
    }
  },

  async downloadAll() {
    if (!this.results.length) return;
    const JSZip = await this._loadScript('https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js', 'JSZip');
    if (!JSZip) { alert('Could not load ZIP library. Download files individually.'); return; }

    const zip = new JSZip();
    const folder = zip.folder('ugc-studio-shots');
    this.results.forEach((r, i) => {
      if (r.isVideo && r.videoData?.data) {
        const ext = r.videoData.mimeType?.includes('mp4') ? 'mp4' : 'webm';
        folder.file(`ugc-${r.shotType}-${i+1}.${ext}`, r.videoData.data, { base64: true });
      } else if (r.imgData?.data) {
        folder.file(`ugc-${r.shotType}-${i+1}.jpg`, r.imgData.data, { base64: true });
      }
    });
    const blob = await zip.generateAsync({ type: 'blob' });
    const url  = URL.createObjectURL(blob);
    this.download(url, `ugc-studio-${Date.now()}.zip`);
    URL.revokeObjectURL(url);
  },

  _loadScript(src, globalName) {
    return new Promise(resolve => {
      if (window[globalName]) { resolve(window[globalName]); return; }
      const s = document.createElement('script');
      s.src = src;
      s.onload  = () => resolve(window[globalName]);
      s.onerror = () => resolve(null);
      document.head.appendChild(s);
    });
  }

};

/* â”€â”€â”€ Prompt Templates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

function SCRAPE_PROMPT(url) {
  return `Visit and analyze this product page URL. Return ONLY valid JSON (no markdown, no code fences) with this exact structure:

{
  "productName": "complete product name",
  "brandName": "brand or company name",
  "tagline": "brand tagline if visible, or null",
  "description": "product description in 2-3 sentences",
  "targetDemographic": {
    "gender": "male / female / all",
    "ageRange": "e.g. 25-40",
    "lifestyle": "lifestyle descriptor, 5-8 words",
    "psychographic": "values and interests in one sentence"
  },
  "keyBenefits": ["benefit 1", "benefit 2", "benefit 3"],
  "useCases": ["use case 1", "use case 2"],
  "productCategory": "e.g. skincare, fitness equipment, food & beverage",
  "brandAesthetic": "e.g. minimalist luxury, natural & organic, bold & energetic",
  "primaryImageUrl": "full direct URL to the main product image (must end in .jpg .png .webp etc) or null",
  "productColor": "primary color(s) of the product",
  "productMaterial": "primary material if relevant, or null",
  "productSize": "size/weight descriptor if relevant, or null",
  "pricePoint": "budget / mid-range / premium / luxury"
}

URL: ${url}`;
}

function SCRAPE_PROMPT_TEXT(url, pageText) {
  return `Analyze this product page content and extract information. Return ONLY valid JSON (no markdown) with this structure:

{
  "productName": "complete product name",
  "brandName": "brand or company name",
  "tagline": "brand tagline or null",
  "description": "product description in 2-3 sentences",
  "targetDemographic": {
    "gender": "male / female / all",
    "ageRange": "e.g. 25-40",
    "lifestyle": "lifestyle descriptor 5-8 words",
    "psychographic": "values and interests"
  },
  "keyBenefits": ["benefit 1", "benefit 2", "benefit 3"],
  "useCases": ["use case 1", "use case 2"],
  "productCategory": "category",
  "brandAesthetic": "aesthetic style",
  "primaryImageUrl": null,
  "productColor": "color",
  "productMaterial": null,
  "productSize": null,
  "pricePoint": "budget / mid-range / premium / luxury"
}

Page URL: ${url}

Page content:
${pageText}`;
}

function PROMPT_BUILDER(d, personDesc, aestheticDesc, shotList, opts) {
  const hasLifestyle = opts.shots.some(s => s === 'lifestyle');
  const hasDetail    = opts.shots.some(s => s === 'detail');
  const humanShots   = ['hold','unboxing','social','outdoor'];
  const noHumanShots = ['lifestyle','detail'];

  return `You are an expert UGC content director at a top creative agency. Create hyper-realistic image generation prompts for authentic user-generated content photography â€” every image must look like it was genuinely taken on an iPhone by a real consumer, not produced in a studio.

PRODUCT BRIEF:
- Product: ${d.productName}
- Brand: ${d.brandName || 'Unknown'}
- Description: ${d.description}
- Category: ${d.productCategory}
- Target audience: ${d.targetDemographic?.lifestyle || 'general'} (${d.targetDemographic?.gender}, ${d.targetDemographic?.ageRange})
- Brand aesthetic: ${d.brandAesthetic}
- Product appearance: ${d.productColor} ${d.productMaterial || ''} ${d.productSize || ''}
- Price point: ${d.pricePoint || 'mid-range'}
- Key benefits: ${(d.keyBenefits || []).join(', ')}
${opts.context ? '- Extra context: ' + opts.context : ''}

GENERATION SETTINGS:
- Creator/model (for human shots only): ${personDesc}
- Visual aesthetic: ${aestheticDesc}

SHOTS TO CREATE:
${shotList}

CRITICAL RULES â€” apply to EVERY prompt:

HUMAN PRESENCE RULES (strictly enforced):
- Shot types ${humanShots.join(', ').toUpperCase()}: Feature ${personDesc} naturally in the scene
- Shot types ${noHumanShots.join(', ').toUpperCase()}: ABSOLUTELY NO people, NO hands, NO body parts whatsoever â€” product only, beautifully placed in its environment

iPhone REALISM RULES (strictly enforced â€” every single prompt must feel like a real iPhone photo):
1. Shot on iPhone 15 Pro, natural available light only â€” no flash, no ring lights, no studio setup
2. Slightly imperfect framing â€” not perfectly centered, real-person composition
3. Natural depth of field â€” soft background blur (Portrait mode feel), sharp subject
4. Real-world clutter is fine â€” a coffee cup nearby, keys on the counter, an open book â€” authentic environmental context
5. Authentic, slightly imperfect quality â€” like a real consumer posted this to their Instagram story
6. Specific location + time of day + lighting condition in every prompt (e.g. "morning light streaming through kitchen window", "golden hour on a wooden deck", "overcast afternoon at a cafÃ© table")

PRODUCT ACCURACY:
- Always reference the exact product color and name
- Describe how it is held, placed, or positioned precisely
- If two prompts share the same shot type, vary the scene, location, and angle significantly

Each prompt must be 90â€“130 words long.
End every prompt with: ", shot on iPhone 15 Pro, natural light, authentic UGC, no studio"

Return ONLY a JSON array of exactly ${opts.shots.length} prompt strings. No other text.
["prompt 1", "prompt 2", ...]`;
}

/* â”€â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
App.init();
</script>
</body>
</html>
